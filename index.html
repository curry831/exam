<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å•è¯è€ƒè¯•æ¨¡å¼</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- SheetJS (xlsx) CDN for Reading Excel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans SC', sans-serif;
        }
        /* é€‰é¡¹æŒ‰é’®çš„è¿‡æ¸¡æ•ˆæœ */
        .option-btn {
            transition: all 0.2s ease-in-out;
        }
        .option-btn:hover:not(.disabled) {
            transform: translateX(5px);
        }
        /* ç¦ç”¨ç‚¹å‡»åçš„æ ·å¼ */
        .disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }
        /* æ­£ç¡®ç­”æ¡ˆé«˜äº® */
        .correct {
            background-color: #10b981; /* green-500 */
            color: white;
            border-color: #10b981;
        }
        /* é”™è¯¯ç­”æ¡ˆé«˜äº® */
        .incorrect {
            background-color: #ef4444; /* red-500 */
            color: white;
            border-color: #ef4444;
        }
        /* é¼“åŠ±æç¤ºçš„æ ·å¼ */
        #encouragement-toast {
            transform: translateX(-50%) translateY(-100px);
            opacity: 0;
            transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        #encouragement-toast.show {
            transform: translateX(-50%) translateY(20px);
            opacity: 1;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-50 to-pink-100 min-h-screen flex items-center justify-center p-4">
    <!-- é¼“åŠ±æç¤ºå®¹å™¨ -->
    <div id="encouragement-toast" class="fixed top-4 left-1/2 z-50 bg-green-500 text-white font-bold py-3 px-6 rounded-lg shadow-lg">
        <span id="encouragement-text"></span>
    </div>

    <div class="container mx-auto max-w-2xl bg-white rounded-lg shadow-xl p-6 sm:p-8">

        <!-- æ–‡ä»¶ä¸Šä¼ åŒºåŸŸ -->
        <section id="upload-section" class="text-center">
            <h1 class="text-3xl font-bold text-gray-800 mb-4">ğŸ§  å•è¯è€ƒè¯•æ¨¡å¼</h1>
            <p class="text-gray-600 mb-6">è¯·é€‰æ‹©æ‚¨ä»è®°å½•æœ¬å¯¼å‡ºçš„Excelæ–‡ä»¶æ¥å¼€å§‹è€ƒè¯•</p>
            <label for="file-input" class="bg-indigo-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-indigo-700 transition duration-300 cursor-pointer">
                é€‰æ‹©Excelæ–‡ä»¶
            </label>
            <input type="file" id="file-input" accept=".xlsx, .xls" class="hidden">

            <!-- æ–°å¢ï¼šæ“ä½œæŒ‡å— -->
            <div class="mt-8 p-4 bg-blue-50 border border-blue-200 rounded-lg text-left">
                <h3 class="font-bold text-blue-800 mb-2 flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg>
                    å¦‚ä½•ä»å¾®ä¿¡å¯¼å…¥æ–‡ä»¶ï¼Ÿ
                </h3>
                <p class="text-sm text-blue-700 mb-2">ç”±äºæµè§ˆå™¨å®‰å…¨é™åˆ¶ï¼Œæ‚¨éœ€è¦å…ˆå°†æ–‡ä»¶ä¿å­˜åˆ°æ‰‹æœºï¼Œå†é€šè¿‡æœ¬é¡µé¢é€‰æ‹©ã€‚</p>
                <ol class="text-sm text-blue-700 list-decimal list-inside space-y-1">
                    <li>åœ¨å¾®ä¿¡ä¸­æ‰¾åˆ°Excelæ–‡ä»¶ï¼Œç‚¹å‡»é¢„è§ˆã€‚</li>
                    <li>ç‚¹å‡»å³ä¸Šè§’ <strong>...</strong>ï¼Œé€‰æ‹© <strong>â€œç”¨å…¶ä»–åº”ç”¨æ‰“å¼€â€</strong>ã€‚</li>
                    <li>åœ¨åº”ç”¨åˆ—è¡¨ä¸­æ‰¾åˆ°å¹¶é€‰æ‹© <strong>â€œå­˜å‚¨åˆ°æ–‡ä»¶â€</strong>ã€‚</li>
                    <li>è¿”å›æœ¬é¡µé¢ï¼Œç‚¹å‡»ä¸Šæ–¹æŒ‰é’®ï¼Œä»æ‰‹æœºæ–‡ä»¶ä¸­é€‰æ‹©åˆšåˆšä¿å­˜çš„Excelæ–‡ä»¶ã€‚</li>
                </ol>
            </div>
        </section>

        <!-- è€ƒè¯•åŒºåŸŸ -->
        <section id="quiz-section" class="hidden">
            <div class="mb-6 flex justify-between items-center">
                <span id="question-counter" class="text-sm font-medium text-gray-500">é¢˜ç›® 1 / 20</span>
                <!-- ä¼˜åŒ–: è®©å¾—åˆ†æ˜¾ç¤ºæ›´é†’ç›® -->
                <span id="score-display" class="text-lg font-bold text-white bg-indigo-600 px-4 py-1 rounded-full shadow-lg">å¾—åˆ†: 0</span>
            </div>
            <div class="mb-6">
                <h2 id="question-word" class="text-2xl font-bold text-center text-gray-800"></h2>
            </div>
            <div id="options-container" class="space-y-3">
                <!-- é€‰é¡¹å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
            </div>
            <div class="mt-6 text-center">
                <p id="feedback" class="font-semibold mb-4 text-lg"></p>
                <button id="next-btn" class="bg-green-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-green-700 transition duration-300 hidden">
                    ä¸‹ä¸€é¢˜
                </button>
            </div>
        </section>

        <!-- ç»“æœåŒºåŸŸ -->
        <section id="result-section" class="hidden text-center">
            <h2 class="text-3xl font-bold text-gray-800 mb-4">ğŸ‰ è€ƒè¯•ç»“æŸï¼</h2>
            <!-- ä¼˜åŒ–: è®©æœ€ç»ˆå¾—åˆ†æ›´çªå‡º -->
            <div class="bg-gray-100 rounded-lg p-6 mb-6">
                <p id="final-score" class="text-2xl font-bold text-gray-700"></p>
            </div>
            <button id="restart-btn" class="bg-indigo-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-indigo-700 transition duration-300">
                é‡æ–°å¼€å§‹
            </button>
        </section>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const fileInput = document.getElementById('file-input');
            const uploadSection = document.getElementById('upload-section');
            const quizSection = document.getElementById('quiz-section');
            const resultSection = document.getElementById('result-section');
            const questionCounter = document.getElementById('question-counter');
            const scoreDisplay = document.getElementById('score-display');
            const questionWord = document.getElementById('question-word');
            const optionsContainer = document.getElementById('options-container');
            const feedback = document.getElementById('feedback');
            const nextBtn = document.getElementById('next-btn');
            const finalScore = document.getElementById('final-score');
            const restartBtn = document.getElementById('restart-btn');
            const encouragementToast = document.getElementById('encouragement-toast');
            const encouragementText = document.getElementById('encouragement-text');

            let allWords = [];
            let currentQuestionIndex = 0;
            let score = 0;

            // --- é¼“åŠ±è¯­å¥åº“ ---
            const correctAnswers = [
                "ç­”å¯¹äº†ï¼å¤ªæ£’äº†ï¼",
                "æ­£ç¡®ï¼ä½ çœŸæ˜¯ä¸ªå¤©æ‰ï¼",
                "æ²¡é”™ï¼ç»§ç»­ä¿æŒï¼",
                "Excellent! å®Œç¾ï¼",
                "å°±æ˜¯è¿™ä¹ˆç®€å•ï¼"
            ];

            const finalEncouragements = {
                high: [
                    "ğŸ† å“è¶Šï¼ä½ å¯¹è¿™äº›å•è¯çš„æŒæ¡å·²ç»ç‚‰ç«çº¯é’ï¼",
                    "ğŸŒŸ å®Œç¾ï¼ä½ æ˜¯çœŸæ­£çš„å•è¯å¤§å¸ˆï¼",
                    "ğŸ¯ æƒŠè‰³ï¼è¿™ä¸ªåˆ†æ•°è¯æ˜äº†ä½ çš„åŠªåŠ›å’Œå¤©èµ‹ï¼"
                ],
                medium: [
                    "ğŸ‘ åšå¾—å¾ˆå¥½ï¼ä½ å·²ç»æŒæ¡äº†å¤§éƒ¨åˆ†å†…å®¹ï¼",
                    "ğŸ’ª ä¸é”™ï¼å†æ¥å†å‰ï¼Œä½ ç¦»æ»¡åˆ†ä¸è¿œäº†ï¼",
                    "ğŸ‘ å€¼å¾—ç§°èµï¼ä½ çš„åŠªåŠ›å¾—åˆ°äº†å›æŠ¥ï¼"
                ],
                low: [
                    "ğŸ’¡ åŠ æ²¹ï¼å­¦ä¹ æ˜¯ä¸€ä¸ªè¿‡ç¨‹ï¼Œæ¯æ¬¡ç»ƒä¹ éƒ½æ˜¯è¿›æ­¥ï¼",
                    "ğŸŒ± åˆ«ç°å¿ƒï¼ç½—é©¬ä¸æ˜¯ä¸€å¤©å»ºæˆçš„ï¼Œç»§ç»­åŠªåŠ›ï¼",
                    "ğŸ“š ä¸é”™çš„å¼€å§‹ï¼æ‰¾å‡ºè–„å¼±ç¯èŠ‚ï¼Œä¸‹æ¬¡ä¼šæ›´å¥½ï¼"
                ]
            };

            // --- äº‹ä»¶ç›‘å¬ ---
            fileInput.addEventListener('change', handleFileUpload);
            nextBtn.addEventListener('click', displayNextQuestion);
            restartBtn.addEventListener('click', resetQuiz);

            // --- æ ¸å¿ƒåŠŸèƒ½ ---
            function handleFileUpload(event) {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, { type: 'array' });
                        const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                        const jsonData = XLSX.utils.sheet_to_json(firstSheet);

                        // è¿‡æ»¤æ‰æ²¡æœ‰é‡Šä¹‰çš„å•è¯
                        allWords = jsonData.filter(row => row.é‡Šä¹‰ && row.é‡Šä¹‰.trim() !== '');
                        
                        if (allWords.length < 4) {
                            alert('å•è¯æ•°é‡å¤ªå°‘ï¼Œæ— æ³•ç”Ÿæˆæœ‰æ•ˆçš„è€ƒé¢˜ï¼Œè¯·è‡³å°‘åŒ…å«4ä¸ªæœ‰é‡Šä¹‰çš„å•è¯ã€‚');
                            return;
                        }

                        startQuiz();
                    } catch (error) {
                        alert('æ–‡ä»¶è¯»å–å¤±è´¥ï¼Œè¯·ç¡®ä¿æ‚¨é€‰æ‹©äº†æ­£ç¡®çš„Excelæ–‡ä»¶ã€‚');
                        console.error(error);
                    }
                };
                reader.readAsArrayBuffer(file);
            }

            function startQuiz() {
                currentQuestionIndex = 0;
                score = 0;
                // éšæœºæ‰“ä¹±é¢˜ç›®é¡ºåº
                allWords.sort(() => Math.random() - 0.5);
                
                uploadSection.classList.add('hidden');
                quizSection.classList.remove('hidden');
                resultSection.classList.add('hidden');

                displayQuestion();
            }

            function displayQuestion() {
                if (currentQuestionIndex >= allWords.length) {
                    showResults();
                    return;
                }

                const currentWord = allWords[currentQuestionIndex];
                questionWord.textContent = currentWord.å•è¯;
                questionCounter.textContent = `é¢˜ç›® ${currentQuestionIndex + 1} / ${allWords.length}`;
                scoreDisplay.textContent = `å¾—åˆ†: ${score}`;
                
                feedback.textContent = '';
                nextBtn.classList.add('hidden');
                
                generateOptions(currentWord);
            }

            function generateOptions(currentWord) {
                optionsContainer.innerHTML = '';
                const correctAnswer = currentWord.é‡Šä¹‰;
                const options = [correctAnswer];

                // ä»å…¶ä»–å•è¯ä¸­éšæœºæŒ‘é€‰3ä¸ªä½œä¸ºé”™è¯¯é€‰é¡¹
                while (options.length < 4) {
                    const randomWord = allWords[Math.floor(Math.random() * allWords.length)];
                    if (randomWord.é‡Šä¹‰ && !options.includes(randomWord.é‡Šä¹‰)) {
                        options.push(randomWord.é‡Šä¹‰);
                    }
                }

                // éšæœºæ‰“ä¹±é€‰é¡¹é¡ºåº
                options.sort(() => Math.random() - 0.5);

                options.forEach(option => {
                    const button = document.createElement('button');
                    button.textContent = option;
                    button.className = 'option-btn w-full text-left p-4 border-2 border-gray-300 rounded-lg hover:border-indigo-500 focus:outline-none';
                    button.onclick = () => selectAnswer(button, option === correctAnswer);
                    optionsContainer.appendChild(button);
                });
            }

            function selectAnswer(buttonElement, isCorrect) {
                // ç¦ç”¨æ‰€æœ‰æŒ‰é’®
                const allButtons = optionsContainer.querySelectorAll('.option-btn');
                allButtons.forEach(btn => {
                    btn.onclick = null;
                    btn.classList.add('disabled');
                });

                if (isCorrect) {
                    buttonElement.classList.add('correct');
                    feedback.textContent = 'âœ… æ­£ç¡®ï¼';
                    feedback.className = 'font-semibold mb-4 text-lg text-green-600';
                    score++;
                    // --- æ˜¾ç¤ºç­”å¯¹é¼“åŠ± ---
                    showCorrectAnswerEncouragement();
                } else {
                    buttonElement.classList.add('incorrect');
                    feedback.textContent = 'âŒ é”™è¯¯ï¼';
                    feedback.className = 'font-semibold mb-4 text-lg text-red-600';
                    // é«˜äº®æ­£ç¡®ç­”æ¡ˆ
                    allButtons.forEach(btn => {
                        if (btn.textContent === allWords[currentQuestionIndex].é‡Šä¹‰) {
                            btn.classList.add('correct');
                        }
                    });
                }
                
                scoreDisplay.textContent = `å¾—åˆ†: ${score}`;
                nextBtn.classList.remove('hidden');
            }

            function displayNextQuestion() {
                currentQuestionIndex++;
                displayQuestion();
            }

            function showResults() {
                quizSection.classList.add('hidden');
                resultSection.classList.remove('hidden');
                const percentage = Math.round(score / allWords.length * 100);
                finalScore.innerHTML = `æ‚¨çš„æœ€ç»ˆå¾—åˆ†æ˜¯ <span class="text-3xl text-indigo-600">${score}</span> / ${allWords.length} <br> <span class="text-xl">æ­£ç¡®ç‡: ${percentage}%</span>`;
                
                // --- æ˜¾ç¤ºæœ€ç»ˆé¼“åŠ± ---
                showFinalEncouragement(percentage);
            }

            function resetQuiz() {
                resultSection.classList.add('hidden');
                uploadSection.classList.remove('hidden');
                fileInput.value = ''; // æ¸…ç©ºæ–‡ä»¶è¾“å…¥ï¼Œå…è®¸é‡æ–°é€‰æ‹©åŒä¸€æ–‡ä»¶
            }

            // --- é¼“åŠ±æç¤ºåŠŸèƒ½ ---
            const showCorrectAnswerEncouragement = () => {
                const randomIndex = Mathã€‚floor(Mathã€‚random() * correctAnswers.length);
                const message = correctAnswers[randomIndex];
                showToast(message);
            };

            const showFinalEncouragement = (percentage) => {
                let message;
                let encouragements;
                
                if (percentage >= 90) {
                    encouragements = finalEncouragementsã€‚high;
                } else if (percentage >= 60) {
                    encouragements = finalEncouragementsã€‚medium;
                } else {
                    encouragements = finalEncouragements.low;
                }

                const randomIndex = Math.floor(Math.random() * encouragements.length);
                message = encouragements[randomIndex];
                
                // å»¶è¿Ÿæ˜¾ç¤ºï¼Œè®©ç”¨æˆ·å…ˆçœ‹åˆ°åˆ†æ•°
                setTimeout(() => {
                    showToast(message);
                }, 500);
            };

            const showToast = (message) => {
                encouragementTextã€‚textContent = message;
                
                // æ˜¾ç¤ºæç¤º
                encouragementToastã€‚classList.add('show');

                // 3ç§’åéšè—
                setTimeout(() => {
                    encouragementToast.classList.remove('show');
                }, 3000);
            };
        });
    </script>
</body>
</html>
