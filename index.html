<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŸç¥é£æ ¼ - å•è¯å¤ä¹ ç³»ç»Ÿ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Noto Sans SC', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #1a1f3a 0%, #2d1b69 50%, #0f172a 100%);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }
        
        /* èƒŒæ™¯è£…é¥° */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(255, 219, 98, 0.2) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }
        
        /* æ˜Ÿæ˜ŸèƒŒæ™¯ */
        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }
        
        .star {
            position: absolute;
            width: 2px;
            height: 2px;
            background: white;
            border-radius: 50%;
            animation: twinkle 3s infinite;
        }
        
        @keyframes twinkle {
            0%, 100% { opacity: 0; }
            50% { opacity: 1; }
        }
        
        /* ä¸»å®¹å™¨ */
        .main-container {
            position: relative;
            z-index: 10;
        }
        
        /* å¡ç‰‡æ ·å¼ */
        .genshin-card {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.95) 0%, rgba(15, 23, 42, 0.95) 100%);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 16px;
            box-shadow: 
                0 10px 40px rgba(0, 0, 0, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }
        
        /* é‡‘è‰²æŒ‰é’® */
        .genshin-btn {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: #1e293b;
            font-weight: 600;
            border-radius: 12px;
            box-shadow: 
                0 4px 20px rgba(251, 191, 36, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .genshin-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transition: left 0.5s ease;
        }
        
        .genshin-btn:hover::before {
            left: 100%;
        }
        
        .genshin-btn:hover {
            transform: translateY(-2px);
            box-shadow: 
                0 6px 30px rgba(251, 191, 36, 0.6),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }
        
        .genshin-btn:active {
            transform: translateY(0);
        }
        
        /* ç´«è‰²æŒ‰é’® */
        .genshin-btn-purple {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            color: white;
            box-shadow: 
                0 4px 20px rgba(139, 92, 246, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }
        
        .genshin-btn-purple:hover {
            box-shadow: 
                0 6px 30px rgba(139, 92, 246, 0.6),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }
        
        /* é€‰é¡¹å¡ç‰‡ - ä¿®æ”¹ä¸ºç›´æ¥æäº¤ */
        .option-card {
            background: rgba(30, 41, 59, 0.8);
            border: 2px solid rgba(139, 92, 246, 0.3);
            border-radius: 12px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }
        
        .option-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, transparent 0%, rgba(139, 92, 246, 0.1) 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .option-card:hover::before {
            opacity: 1;
        }
        
        .option-card:hover {
            transform: translateY(-2px);
            border-color: rgba(139, 92, 246, 0.6);
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.3);
        }
        
        .option-card.selected {
            border-color: #fbbf24;
            background: rgba(251, 191, 36, 0.1);
        }
        
        .option-card.correct {
            border-color: #10b981;
            background: rgba(16, 185, 129, 0.1);
            animation: correctPulse 0.6s ease;
            pointer-events: none;
        }
        
        .option-card.wrong {
            border-color: #ef4444;
            background: rgba(239, 68, 68, 0.1);
            animation: wrongShake 0.6s ease;
            pointer-events: none;
        }
        
        .option-card.answered:not(.correct):not(.wrong) {
            pointer-events: none;
            opacity: 0.6;
        }
        
        @keyframes correctPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        @keyframes wrongShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        /* è¿›åº¦æ¡ */
        .progress-bar {
            background: linear-gradient(90deg, #fbbf24 0%, #f59e0b 100%);
            border-radius: 999px;
            position: relative;
            overflow: hidden;
        }
        
        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent 0%, rgba(255, 255, 255, 0.3) 50%, transparent 100%);
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        /* æ–‡å­—æ ·å¼ */
        .genshin-title {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 2px 10px rgba(251, 191, 36, 0.3);
        }
        
        .genshin-text {
            color: #e2e8f0;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
        }
        
        /* æ¨¡æ€æ¡† */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            backdrop-filter: blur(5px);
        }
        
        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.98) 0%, rgba(15, 23, 42, 0.98) 100%);
            border: 2px solid rgba(251, 191, 36, 0.3);
            border-radius: 20px;
            padding: 2rem;
            max-width: 400px;
            width: 90%;
            text-align: center;
            box-shadow: 
                0 20px 60px rgba(0, 0, 0, 0.8),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }
        
        /* ä¸Šä¼ åŒºåŸŸ */
        .upload-area {
            border: 2px dashed rgba(139, 92, 246, 0.5);
            border-radius: 16px;
            padding: 3rem 2rem;
            text-align: center;
            transition: all 0.3s ease;
            background: rgba(30, 41, 59, 0.5);
            position: relative;
            overflow: hidden;
        }
        
        .upload-area::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at center, rgba(139, 92, 246, 0.1) 0%, transparent 70%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .upload-area:hover::before {
            opacity: 1;
        }
        
        .upload-area:hover {
            border-color: rgba(139, 92, 246, 0.8);
            background: rgba(30, 41, 59, 0.8);
        }
        
        .upload-area.dragover {
            border-color: #fbbf24;
            background: rgba(251, 191, 36, 0.1);
        }
        
        /* æ–‡ä»¶è¾“å…¥æ ·å¼ */
        .file-input-label {
            display: inline-block;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .file-input-label:hover {
            transform: translateY(-2px);
        }
        
        .file-input {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
            z-index: 10;
        }
        
        /* ç»Ÿè®¡å¡ç‰‡ */
        .stat-card {
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid rgba(139, 92, 246, 0.3);
            border-radius: 12px;
            padding: 1rem;
            text-align: center;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .genshin-card {
                margin: 0.5rem;
                padding: 1rem;
            }
            
            .upload-area {
                padding: 2rem 1rem;
            }
            
            .text-3xl {
                font-size: 1.5rem;
            }
            
            .text-4xl {
                font-size: 2rem;
            }
            
            .grid-cols-3 {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }
            
            .flex.space-x-4 {
                flex-direction: column;
                gap: 0.5rem;
            }
        }
        
        /* åŠ¨ç”» */
        .fade-in {
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .slide-up {
            animation: slideUp 0.5s ease;
        }
        
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* æ»šåŠ¨æ¡æ ·å¼ */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(30, 41, 59, 0.5);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(139, 92, 246, 0.5);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(139, 92, 246, 0.7);
        }
    </style>
</head>
<body>
    <!-- æ˜Ÿæ˜ŸèƒŒæ™¯ -->
    <div class="stars" id="stars"></div>
    
    <!-- ä¸»å®¹å™¨ -->
    <div class="main-container container mx-auto px-4 py-4 md:py-8 max-w-4xl">
        <!-- å¤´éƒ¨ -->
        <header class="text-center mb-6 md:mb-8">
            <div class="inline-flex items-center justify-center mb-3">
                <i class="fas fa-star text-yellow-400 text-3xl md:text-4xl mr-2 animate-pulse"></i>
                <h1 class="text-2xl md:text-4xl font-bold genshin-title">åŸç¥å•è¯å¤ä¹ ç³»ç»Ÿ</h1>
                <i class="fas fa-star text-yellow-400 text-3xl md:text-4xl ml-2 animate-pulse"></i>
            </div>
            <p class="genshin-text text-sm md:text-base">è¸ä¸Šæç“¦ç‰¹å¤§é™†çš„å•è¯å­¦ä¹ ä¹‹æ—…</p>
        </header>

        <!-- ä¸Šä¼ é¡µé¢ -->
        <div id="uploadSection" class="genshin-card p-4 md:p-8 mb-4">
            <div class="text-center">
                <div class="mb-6">
                    <i class="fas fa-cloud-upload-alt text-4xl md:text-6xl text-purple-400 mb-3 md:mb-4"></i>
                    <h2 class="text-lg md:text-xl font-semibold genshin-text mb-2">ä¸Šä¼ å•è¯æ–‡ä»¶</h2>
                    <p class="genshin-text text-xs md:text-sm opacity-80">æ”¯æŒ .xlsx, .xls æ ¼å¼</p>
                </div>
                
                <!-- ä¿®å¤åçš„ä¸Šä¼ åŒºåŸŸ -->
                <div class="upload-area" id="uploadArea">
                    <label for="fileInput" class="file-input-label">
                        <input type="file" id="fileInput" accept=".xlsx,.xls" class="file-input">
                        <div class="genshin-btn-purple px-6 py-3 md:px-8 md:py-4 rounded-xl font-medium inline-block">
                            <i class="fas fa-folder-open mr-2"></i>
                            é€‰æ‹©Excelæ–‡ä»¶
                        </div>
                        <p class="genshin-text text-xs md:text-sm mt-3 opacity-60">æˆ–æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„</p>
                    </label>
                </div>
                
                <div id="fileInfo" class="mt-4 hidden">
                    <div class="bg-green-900 bg-opacity-50 border border-green-500 rounded-lg p-3 md:p-4">
                        <p class="text-green-300 text-sm">
                            <i class="fas fa-check-circle mr-2"></i>
                            <span id="fileName"></span>
                        </p>
                        <p class="text-green-400 text-xs mt-1">
                            å…± <span id="wordCount" class="font-bold"></span> ä¸ªå•è¯
                        </p>
                    </div>
                </div>
                
                <button id="startBtn" class="mt-4 md:mt-6 genshin-btn px-6 py-3 md:px-8 md:py-4 rounded-xl font-medium disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                    <i class="fas fa-play mr-2"></i>
                    å¼€å§‹å†’é™©
                </button>
            </div>
            
            <!-- ä½¿ç”¨è¯´æ˜ -->
            <div class="mt-4 md:mt-6 bg-purple-900 bg-opacity-30 rounded-lg p-3 md:p-4 border border-purple-500 border-opacity-30">
                <h3 class="font-semibold genshin-text mb-2 text-sm">
                    <i class="fas fa-info-circle mr-2 text-purple-400"></i>
                    å†’é™©æŒ‡å—
                </h3>
                <ul class="text-xs genshin-text space-y-1 opacity-80">
                    <li>â€¢ Excelæ ¼å¼ï¼šæ—¶é—´|å•è¯|é‡Šä¹‰ï¼ˆç¬¬ä¸€è¡Œä¸ºæ ‡é¢˜ï¼‰</li>
                    <li>â€¢ æ¯é¢˜4ä¸ªé€‰é¡¹ï¼Œç­”å¯¹å¾—10åŸçŸ³</li>
                    <li>â€¢ ç‚¹å‡»é€‰é¡¹ç›´æ¥ç­”é¢˜ï¼Œæ— éœ€ç¡®è®¤</li>
                </ul>
            </div>
        </div>

        <!-- ç­”é¢˜é¡µé¢ -->
        <div id="quizSection" class="hidden">
            <!-- è¿›åº¦æ¡ -->
            <div class="genshin-card rounded-t-2xl p-3 md:p-4">
                <div class="flex justify-between items-center mb-2">
                    <span class="genshin-text text-xs md:text-sm">å†’é™©è¿›åº¦</span>
                    <span class="genshin-text text-xs md:text-sm font-semibold">
                        <span id="currentQuestion">1</span> / <span id="totalQuestions">10</span>
                    </span>
                </div>
                <div class="w-full bg-gray-700 rounded-full h-2 md:h-3">
                    <div id="progressBar" class="progress-bar h-2 md:h-3 rounded-full transition-all duration-300" style="width: 0%"></div>
                </div>
            </div>
            
            <!-- ç­”é¢˜åŒºåŸŸ -->
            <div class="genshin-card rounded-b-2xl p-4 md:p-6">
                <!-- å¾—åˆ†æ˜¾ç¤º -->
                <div class="flex flex-col md:flex-row justify-between items-center mb-4 md:mb-6 gap-2 md:gap-0">
                    <div class="flex space-x-2 md:space-x-3">
                        <div class="stat-card">
                            <span class="text-green-400 text-xs md:text-sm font-medium">
                                <i class="fas fa-check-circle mr-1"></i>
                                æ­£ç¡®: <span id="correctCount">0</span>
                            </span>
                        </div>
                        <div class="stat-card">
                            <span class="text-red-400 text-xs md:text-sm font-medium">
                                <i class="fas fa-times-circle mr-1"></i>
                                é”™è¯¯: <span id="wrongCount">0</span>
                            </span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <span class="text-yellow-400 text-xs md:text-sm font-medium">
                            <i class="fas fa-gem mr-1"></i>
                            åŸçŸ³: <span id="score">0</span>
                        </span>
                    </div>
                </div>
                
                <!-- å•è¯æ˜¾ç¤º -->
                <div class="text-center mb-4 md:mb-6">
                    <div class="bg-gradient-to-r from-purple-900 to-blue-900 bg-opacity-50 rounded-xl p-4 md:p-6 mb-4 border border-purple-500 border-opacity-30">
                        <h3 class="genshin-text text-sm md:text-base mb-3">é€‰æ‹©å•è¯çš„æ­£ç¡®é‡Šä¹‰ï¼š</h3>
                        <div id="wordDisplay" class="text-2xl md:text-4xl font-bold genshin-title fade-in">
                            <!-- å•è¯å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ -->
                        </div>
                    </div>
                    
                    <!-- é€‰é¡¹ -->
                    <div id="optionsContainer" class="max-w-xl mx-auto space-y-2 md:space-y-3">
                        <!-- é€‰é¡¹å°†åŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
            </div>
        </div>

        <!-- ç»“æœé¡µé¢ -->
        <div id="resultSection" class="hidden">
            <div class="genshin-card p-4 md:p-6">
                <div class="text-center mb-4 md:mb-6">
                    <div class="mb-4">
                        <i class="fas fa-trophy text-4xl md:text-6xl text-yellow-400 mb-3 md:mb-4"></i>
                        <h2 class="text-xl md:text-2xl font-bold genshin-title mb-2">å†’é™©å®Œæˆï¼</h2>
                    </div>
                    
                    <!-- æˆç»©ç»Ÿè®¡ -->
                    <div class="grid grid-cols-3 gap-2 md:gap-4 mb-4 md:mb-6">
                        <div class="stat-card">
                            <div class="text-xl md:text-2xl font-bold text-blue-400" id="finalScore">0</div>
                            <div class="text-xs genshin-text">æ€»åŸçŸ³</div>
                        </div>
                        <div class="stat-card">
                            <div class="text-xl md:text-2xl font-bold text-green-400" id="finalCorrect">0</div>
                            <div class="text-xs genshin-text">æ­£ç¡®æ•°</div>
                        </div>
                        <div class="stat-card">
                            <div class="text-xl md:text-2xl font-bold text-purple-400" id="accuracy">0%</div>
                            <div class="text-xs genshin-text">æ­£ç¡®ç‡</div>
                        </div>
                    </div>
                    
                    <!-- è¯„ä»· -->
                    <div id="evaluation" class="mb-4 md:mb-6">
                        <!-- è¯„ä»·å†…å®¹å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ -->
                    </div>
                    
                    <!-- æ“ä½œæŒ‰é’® -->
                    <div class="flex flex-col md:flex-row justify-center space-y-2 md:space-y-0 md:space-x-3">
                        <button id="reviewBtn" class="genshin-btn px-6 py-2 md:px-8 md:py-3 rounded-xl font-medium">
                            <i class="fas fa-redo mr-2"></i>
                            é‡æ–°å†’é™©
                        </button>
                        <button id="wrongBtn" class="genshin-btn-purple px-6 py-2 md:px-8 md:py-3 rounded-xl font-medium">
                            <i class="fas fa-times mr-2"></i>
                            æŒ‘æˆ˜é”™é¢˜
                        </button>
                        <button id="newFileBtn" class="genshin-btn-purple px-6 py-2 md:px-8 md:py-3 rounded-xl font-medium">
                            <i class="fas fa-file-upload mr-2"></i>
                            æ–°çš„å†’é™©
                        </button>
                    </div>
                </div>
                
                <!-- è¯¦ç»†ç»“æœ -->
                <div class="mt-4 md:mt-6 border-t border-gray-600 pt-4">
                    <h3 class="text-lg font-semibold genshin-text mb-3">
                        <i class="fas fa-list-alt mr-2 text-purple-400"></i>
                        å†’é™©è®°å½•
                    </h3>
                    <div id="detailList" class="max-h-48 md:max-h-64 overflow-y-auto space-y-2">
                        <!-- è¯¦ç»†ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- é¼“åŠ±å¼¹çª— -->
    <div id="encouragementModal" class="modal">
        <div class="modal-content">
            <div id="encouragementIcon" class="text-4xl md:text-5xl mb-3 md:mb-4"></div>
            <h3 id="encouragementTitle" class="text-xl md:text-2xl font-bold genshin-title mb-2"></h3>
            <p id="encouragementText" class="genshin-text mb-4"></p>
            <button id="closeModal" class="genshin-btn px-6 py-2 md:px-8 md:py-3 rounded-xl font-medium w-full">
                ç»§ç»­å†’é™©
            </button>
        </div>
    </div>

    <script>
        // ç”Ÿæˆæ˜Ÿæ˜ŸèƒŒæ™¯
        function generateStars() {
            const starsContainer = document.getElementById('stars');
            const starCount = 50;
            
            for (let i = 0; i < starCount; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.animationDelay = Math.random() * 3 + 's';
                starsContainer.appendChild(star);
            }
        }
        
        generateStars();
        
        // å…¨å±€å˜é‡
        let words = [];
        let currentWordIndex = 0;
        let correctAnswers = 0;
        let wrongAnswers = 0;
        let score = 0;
        let answeredWords = [];
        let wrongWords = [];
        let currentOptions = [];
        let isAnswered = false;

        // åŸç¥é£æ ¼é¼“åŠ±è¯­å¥åº“
        const encouragements = [
            { icon: 'â­', title: 'å¤ªæ£’äº†ï¼', text: 'æ—…è¡Œè€…ï¼Œä½ çœŸæ˜¯ä¸ªå¤©æ‰ï¼' },
            { icon: 'âœ¨', title: 'ä¼˜ç§€ï¼', text: 'æ´¾è’™éƒ½ä¸ºä½ æ„Ÿåˆ°éª„å‚²ï¼' },
            { icon: 'ğŸŒŸ', title: 'å®Œç¾ï¼', text: 'è¿™æ ·çš„å®åŠ›ï¼Œè¿ä¸ƒç¥éƒ½è¦ç§°èµï¼' },
            { icon: 'ğŸ’«', title: 'ç²¾å½©ï¼', text: 'æç“¦ç‰¹å¤§é™†å› ä½ è€Œé—ªè€€ï¼' },
            { icon: 'ğŸ†', title: 'å‰å®³ï¼', text: 'ä½ çš„çŸ¥è¯†å¦‚åŒç¥ä¹‹çœ¼èˆ¬ç’€ç’¨ï¼' },
            { icon: 'ğŸŒ ', title: 'å‡ºè‰²ï¼', text: 'é’Ÿç¦»å…ˆç”Ÿä¹Ÿä¼šè®¤å¯ä½ çš„å®åŠ›ï¼' }
        ];

        // DOMå…ƒç´ 
        const uploadSection = document.getElementById('uploadSection');
        const quizSection = document.getElementById('quizSection');
        const resultSection = document.getElementById('resultSection');
        const fileInput = document.getElementById('fileInput');
        const uploadArea = document.getElementById('uploadArea');
        const startBtn = document.getElementById('startBtn');
        const reviewBtn = document.getElementById('reviewBtn');
        const wrongBtn = document.getElementById('wrongBtn');
        const newFileBtn = document.getElementById('newFileBtn');
        const optionsContainer = document.getElementById('optionsContainer');
        const encouragementModal = document.getElementById('encouragementModal');
        const closeModal = document.getElementById('closeModal');

        // äº‹ä»¶ç»‘å®š
        fileInput.addEventListener('change', handleFileUpload);
        startBtn.addEventListener('click', startQuiz);
        reviewBtn.addEventListener('click', restartQuiz);
        wrongBtn.addEventListener('click', reviewWrongWords);
        newFileBtn.addEventListener('click', resetToUpload);
        closeModal.addEventListener('click', hideEncouragement);

        // æ‹–æ‹½ä¸Šä¼ 
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });
        
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });
        
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0 && (files[0].name.endsWith('.xlsx') || files[0].name.endsWith('.xls'))) {
                fileInput.files = files;
                handleFileUpload({ target: { files: files } });
            } else {
                showNotification('è¯·ä¸Šä¼  .xlsx æˆ– .xls æ ¼å¼çš„Excelæ–‡ä»¶ï¼', 'error');
            }
        });

        // å¤„ç†æ–‡ä»¶ä¸Šä¼ 
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            if (!file.name.endsWith('.xlsx') && !file.name.endsWith('.xls')) {
                showNotification('è¯·ä¸Šä¼  .xlsx æˆ– .xls æ ¼å¼çš„Excelæ–‡ä»¶ï¼', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(firstSheet, { header: 1 });
                    
                    // è§£æå•è¯æ•°æ® - è·³è¿‡ç¬¬ä¸€è¡Œï¼ˆæ ‡é¢˜è¡Œï¼‰
                    words = [];
                    for (let i = 1; i < jsonData.length; i++) {
                        if (jsonData[i][1] && jsonData[i][2]) {
                            words.push({
                                time: jsonData[i][0] || '',
                                word: jsonData[i][1].toString().trim(),
                                meaning: jsonData[i][2].toString().trim()
                            });
                        }
                    }
                    
                    if (words.length === 0) {
                        showNotification('Excelæ–‡ä»¶ä¸­æ²¡æœ‰æ‰¾åˆ°æœ‰æ•ˆçš„å•è¯æ•°æ®ï¼', 'error');
                        return;
                    }
                    
                    // æ˜¾ç¤ºæ–‡ä»¶ä¿¡æ¯
                    document.getElementById('fileName').textContent = file.name;
                    document.getElementById('wordCount').textContent = words.length;
                    document.getElementById('fileInfo').classList.remove('hidden');
                    startBtn.disabled = false;
                    
                    showNotification(`æˆåŠŸåŠ è½½ ${words.length} ä¸ªå•è¯ï¼å‡†å¤‡å¼€å§‹å†’é™©ï¼`, 'success');
                } catch (error) {
                    showNotification('æ–‡ä»¶è§£æå¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼ï¼', 'error');
                    console.error(error);
                }
            };
            reader.readAsArrayBuffer(file);
        }

        // å¼€å§‹ç­”é¢˜
        function startQuiz() {
            uploadSection.classList.add('hidden');
            quizSection.classList.remove('hidden');
            
            // æ‰“ä¹±å•è¯é¡ºåº
            words = shuffleArray([...words]);
            
            // åˆå§‹åŒ–ç»Ÿè®¡
            currentWordIndex = 0;
            correctAnswers = 0;
            wrongAnswers = 0;
            score = 0;
            answeredWords = [];
            wrongWords = [];
            
            // æ›´æ–°æ˜¾ç¤º
            updateStats();
            showWord();
        }

        // æ˜¾ç¤ºå½“å‰å•è¯å’Œé€‰é¡¹
        function showWord() {
            if (currentWordIndex >= words.length) {
                showResults();
                return;
            }
            
            const word = words[currentWordIndex];
            document.getElementById('wordDisplay').textContent = word.word;
            document.getElementById('wordDisplay').classList.add('fade-in');
            
            // ç”Ÿæˆé€‰é¡¹
            generateOptions(word);
            
            // æ›´æ–°è¿›åº¦
            updateProgress();
            
            // é‡ç½®ç­”é¢˜çŠ¶æ€
            isAnswered = false;
        }

        // ç”Ÿæˆé€‰æ‹©é¢˜é€‰é¡¹
        function generateOptions(currentWord) {
            currentOptions = [];
            const allMeanings = words.map(w => w.meaning);
            
            // è·å–3ä¸ªéšæœºå¹²æ‰°é¡¹
            const distractors = [];
            while (distractors.length < 3 && distractors.length < allMeanings.length - 1) {
                const randomMeaning = allMeanings[Math.floor(Math.random() * allMeanings.length)];
                if (randomMeaning !== currentWord.meaning && !distractors.includes(randomMeaning)) {
                    distractors.push(randomMeaning);
                }
            }
            
            // åˆå¹¶æ­£ç¡®ç­”æ¡ˆå’Œå¹²æ‰°é¡¹
            const allOptions = [currentWord.meaning, ...distractors];
            
            // æ‰“ä¹±é€‰é¡¹é¡ºåº
            currentOptions = shuffleArray(allOptions);
            
            // æ¸²æŸ“é€‰é¡¹
            optionsContainer.innerHTML = currentOptions.map((option, index) => `
                <div class="option-card p-3 md:p-4" 
                     data-index="${index}" data-value="${option}">
                    <div class="flex items-center">
                        <span class="w-8 h-8 md:w-10 md:h-10 rounded-full bg-gradient-to-r from-purple-500 to-blue-500 text-white font-bold flex items-center justify-center mr-3 md:mr-4 text-sm md:text-base">
                            ${String.fromCharCode(65 + index)}
                        </span>
                        <span class="genshin-text text-sm md:text-base">${option}</span>
                    </div>
                </div>
            `).join('');
            
            // æ·»åŠ ç‚¹å‡»äº‹ä»¶ - ç›´æ¥æäº¤ç­”æ¡ˆ
            document.querySelectorAll('.option-card').forEach(card => {
                card.addEventListener('click', () => submitAnswer(card));
            });
        }

        // æäº¤ç­”æ¡ˆ - ç‚¹å‡»é€‰é¡¹ç›´æ¥æäº¤
        function submitAnswer(card) {
            // é˜²æ­¢é‡å¤ç‚¹å‡»
            if (isAnswered) return;
            isAnswered = true;
            
            const selectedValue = card.dataset.value;
            const word = words[currentWordIndex];
            const isCorrect = selectedValue === word.meaning;
            
            // è®°å½•ç­”é¢˜ç»“æœ
            answeredWords.push({
                word: word.word,
                correctMeaning: word.meaning,
                userAnswer: selectedValue,
                isCorrect: isCorrect
            });
            
            // æ ‡è®°æ‰€æœ‰é€‰é¡¹ä¸ºå·²ç­”é¢˜
            document.querySelectorAll('.option-card').forEach(c => {
                c.classList.add('answered');
            });
            
            // æ˜¾ç¤ºæ­£ç¡®ç­”æ¡ˆ
            document.querySelectorAll('.option-card').forEach(c => {
                if (c.dataset.value === word.meaning) {
                    c.classList.add('correct');
                } else if (c.dataset.value === selectedValue && !isCorrect) {
                    c.classList.add('wrong');
                }
            });
            
            if (isCorrect) {
                correctAnswers++;
                score += 10;
                showEncouragement();
            } else {
                wrongAnswers++;
                wrongWords.push(word);
            }
            
            updateStats();
            
            // å»¶è¿Ÿåæ˜¾ç¤ºä¸‹ä¸€ä¸ªå•è¯
            setTimeout(() => {
                currentWordIndex++;
                showWord();
            }, isCorrect ? 1500 : 2000);
        }

        // æ˜¾ç¤ºé¼“åŠ±å¼¹çª—
        function showEncouragement() {
            const encouragement = encouragements[Math.floor(Math.random() * encouragements.length)];
            
            document.getElementById('encouragementIcon').textContent = encouragement.icon;
            document.getElementById('encouragementTitle').textContent = encouragement.title;
            document.getElementById('encouragementText').textContent = encouragement.text;
            
            encouragementModal.classList.add('show');
        }

        // éšè—é¼“åŠ±å¼¹çª—
        function hideEncouragement() {
            encouragementModal.classList.remove('show');
        }

        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats() {
            document.getElementById('correctCount').textContent = correctAnswers;
            document.getElementById('wrongCount').textContent = wrongAnswers;
            document.getElementById('score').textContent = score;
        }

        // æ›´æ–°è¿›åº¦æ¡
        function updateProgress() {
            const progress = ((currentWordIndex + 1) / words.length) * 100;
            document.getElementById('progressBar').style.width = `${progress}%`;
            document.getElementById('currentQuestion').textContent = currentWordIndex + 1;
            document.getElementById('totalQuestions').textContent = words.length;
        }

        // æ˜¾ç¤ºç»“æœ
        function showResults() {
            quizSection.classList.add('hidden');
            resultSection.classList.remove('hidden');
            
            // è®¡ç®—ç»Ÿè®¡æ•°æ®
            const totalQuestions = words.length;
            const accuracy = totalQuestions > 0 ? Math.round((correctAnswers / totalQuestions) * 100) : 0;
            
            // æ›´æ–°æ˜¾ç¤º
            document.getElementById('finalScore').textContent = score;
            document.getElementById('finalCorrect').textContent = correctAnswers;
            document.getElementById('accuracy').textContent = `${accuracy}%`;
            
            // æ˜¾ç¤ºè¯„ä»·
            let evaluation = '';
            if (accuracy >= 90) {
                evaluation = `
                    <div class="bg-yellow-900 bg-opacity-50 border border-yellow-500 rounded-lg p-3 md:p-4">
                        <i class="fas fa-star text-yellow-400 text-xl mb-1"></i>
                        <p class="font-semibold text-yellow-300">ä¼ å¥‡æ—…è¡Œè€…ï¼ä½ çš„å®åŠ›å ªæ¯”ç¥æ˜ï¼</p>
                    </div>
                `;
            } else if (accuracy >= 70) {
                evaluation = `
                    <div class="bg-blue-900 bg-opacity-50 border border-blue-500 rounded-lg p-3 md:p-4">
                        <i class="fas fa-thumbs-up text-blue-400 text-xl mb-1"></i>
                        <p class="font-semibold text-blue-300">ä¼˜ç§€çš„å†’é™©è€…ï¼ç»§ç»­åŠªåŠ›ï¼</p>
                    </div>
                `;
            } else if (accuracy >= 50) {
                evaluation = `
                    <div class="bg-purple-900 bg-opacity-50 border border-purple-500 rounded-lg p-3 md:p-4">
                        <i class="fas fa-book text-purple-400 text-xl mb-1"></i>
                        <p class="font-semibold text-purple-300">è¿˜æœ‰è¿›æ­¥ç©ºé—´ï¼Œå†æ¥å†å‰ï¼</p>
                    </div>
                `;
            } else {
                evaluation = `
                    <div class="bg-red-900 bg-opacity-50 border border-red-500 rounded-lg p-3 md:p-4">
                        <i class="fas fa-graduation-cap text-red-400 text-xl mb-1"></i>
                        <p class="font-semibold text-red-300">éœ€è¦æ›´å¤šç»ƒä¹ ï¼Œä¸è¦æ”¾å¼ƒï¼</p>
                    </div>
                `;
            }
            document.getElementById('evaluation').innerHTML = evaluation;
            
            // æ˜¾ç¤ºè¯¦ç»†ç»“æœ
            const detailList = document.getElementById('detailList');
            detailList.innerHTML = answeredWords.map((item, index) => `
                <div class="flex items-center justify-between p-2 rounded ${item.isCorrect ? 'bg-green-900 bg-opacity-30' : 'bg-red-900 bg-opacity-30'}">
                    <div class="flex items-center flex-1">
                        <span class="genshin-text mr-2 text-xs md:text-sm">${index + 1}.</span>
                        <div class="text-xs md:text-sm">
                            <span class="font-medium genshin-text">${item.word}</span>
                            <span class="genshin-text opacity-60 mx-2">â†’</span>
                            <span class="${item.isCorrect ? 'text-green-400' : 'text-red-400'}">${item.userAnswer}</span>
                            ${!item.isCorrect ? `<span class="genshin-text opacity-60 ml-2">(æ­£ç¡®: ${item.correctMeaning})</span>` : ''}
                        </div>
                    </div>
                    <i class="fas ${item.isCorrect ? 'fa-check text-green-400' : 'fa-times text-red-400'} text-xs md:text-sm"></i>
                </div>
            `).join('');
        }

        // é‡æ–°å¼€å§‹
        function restartQuiz() {
            resultSection.classList.add('hidden');
            startQuiz();
        }

        // å¤ä¹ é”™é¢˜
        function reviewWrongWords() {
            if (wrongWords.length === 0) {
                showNotification('æ²¡æœ‰é”™é¢˜éœ€è¦å¤ä¹ ï¼', 'info');
                return;
            }
            
            words = [...wrongWords];
            resultSection.classList.add('hidden');
            startQuiz();
        }

        // è¿”å›ä¸Šä¼ é¡µé¢
        function resetToUpload() {
            resultSection.classList.add('hidden');
            uploadSection.classList.remove('hidden');
            fileInput.value = '';
            document.getElementById('fileInfo').classList.add('hidden');
            startBtn.disabled = true;
        }

        // å·¥å…·å‡½æ•°ï¼šæ‰“ä¹±æ•°ç»„
        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message, type) {
            const colors = {
                success: 'bg-green-600',
                error: 'bg-red-600',
                warning: 'bg-yellow-600',
                info: 'bg-blue-600'
            };
            
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 ${colors[type]} text-white px-4 py-2 md:px-6 md:py-3 rounded-lg shadow-lg z-50 fade-in max-w-xs md:max-w-md`;
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'} mr-2"></i>
                ${message}
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
    </script>
</body>
</html>
